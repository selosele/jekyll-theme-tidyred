{% if site.search == true %}
  <div class="search-content" aria-hidden="true">
    {% include search/search_form.html %}
  </div>
{% endif %}

{% assign categories_max = 0 %}
{% for category in site.categories %}
  {% if category[1].size > categories_max %}
    {% assign categories_max = category[1].size %}
  {% endif %}
{% endfor %}

{% assign important_post_arr = site.posts | where: "important", "true" %}

<div class="side-menu" aria-hidden="true">
  <nav class="menu__layer" id="primary-nav" aria-labelledby="nav-title">
    <h2 id="nav-title">Primary links</h2>
    <ul role="menu">
      {%- for link in site.data.navigation.main -%}
      {%- if link.url contains '://' -%}
        {%- assign url = link.url -%}
      {%- else -%}
        {%- assign url = link.url | relative_url -%}
      {%- endif -%}
      <li role="presentation">
        <a href="{{ url }}" {% if link.description %}title="{{ link.description }}" {% endif %} role="menuitem">{{ link.title }}</a>
      </li>
      {%- endfor -%}
    </ul>
  
    <h2>Categories</h2>
    <ul class="menu__grid-list">
      {% for i in (1..categories_max) reversed %}
      {% for category in site.categories %}
      {% if category[1].size == i %}
      <li>
        <a href="/category-list/#{{ category[0] }}">{{ category[0] }}</a>
      </li>
      {% endif %}
      {% endfor %}
      {% endfor %}
    </ul>
  
    {% if site.main_nav.etc %}
    <h2>{{ site.data.ui-text[site.locale].main_nav_etc | default: 'etc.' }}</h2>
    {% endif %}
    {% if site.main_nav.etc and site.main_nav.important_post %}
    <h3>{{ site.data.ui-text[site.locale].main_nav_imporatnt_post | default: 'Important Posts' }}</h3>
    <ul>
      {% for post in important_post_arr limit:5 %}
      <li>
        <a href="{{ post.url }}">{{ post.title }}</a>
      </li>
      {% endfor %}
    </ul>
    {% if important_post_arr.size > 5 %}
    <a href="/important-posts/" class="btn--more">
      <span class="visually-hidden">{{ site.data.ui-text[site.locale].main_nav_important_more }}</span>
    </a>
    {% endif %}
    {% endif %}
    
    <button type="button" class="menu__close" aria-haspopup="menu" aria-controls="primary-nav" aria-expanded="true">
      <span class="visually-hidden">{{ site.data.ui-text[site.locale].menu_close_label | default: 'Close' }}</span>
      <span class="ico" aria-hidden="true"></span>
    </button>
  </nav>
</div>

<div class="loading-wrapper" aria-hidden="true">
  <div class="loading__bar"></div>
</div>